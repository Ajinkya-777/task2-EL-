#!/bin/bash

# =================================================================
# TITLE: Ubuntu OS Hardening Script
# DESCRIPTION: Automates basic security tasks for Lab Task 2.
# =================================================================

echo "Starting OS Hardening Process..."
sleep 2

# 1. Update and Patch System
echo "[*] Updating system packages..."
sudo apt update && sudo apt upgrade -y
sudo apt install unattended-upgrades -y

# 2. Configure Firewall (UFW)
echo "[*] Configuring UFW Firewall..."
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw --force enable
echo "Firewall status:"
sudo ufw status

# 3. Secure Shared Memory
echo "[*] Securing shared memory..."
if ! grep -q "/run/shm" /etc/fstab; then
    echo "none /run/shm tmpfs defaults,ro 0 0" | sudo tee -a /etc/fstab
fi

# 4. Permissions Audit
echo "[*] Creating and securing a sample sensitive file..."
touch ~/sensitive_data.txt
echo "This is private information." > ~/sensitive_data.txt
chmod 600 ~/sensitive_data.txt
chown $USER:$USER ~/sensitive_data.txt

# 5. Disable Unnecessary Services (e.g., CUPS/Printing)
echo "[*] Disabling unnecessary services..."
sudo systemctl stop cups 2>/dev/null
sudo systemctl disable cups 2>/dev/null

# 6. Check for Root access
echo "[*] Listing users with sudo privileges:"
grep '^sudo' /etc/group

echo "================================================================="
echo "HARDENING COMPLETE. Review the output above for your report."
echo "================================================================="
